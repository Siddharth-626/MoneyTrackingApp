(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{8708:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,9324,23)),Promise.resolve().then(a.bind(a,5459))},5459:(e,t,a)=>{"use strict";a.d(t,{AuthProvider:()=>u,c:()=>o});var n=a(5155),l=a(2115),s=a(399),r=a(5887),i=a(2945);let o=(0,l.createContext)({user:null,loading:!0});function u(e){let{children:t}=e,[a,u]=(0,l.useState)(null),[d,c]=(0,l.useState)(!0);(0,l.useEffect)(()=>(0,s.hg)(r.j,async e=>{u(e),e&&await (0,i.rZ)(e.uid),c(!1)}),[]);let p=(0,l.useMemo)(()=>({user:a,loading:d}),[d,a]);return(0,n.jsx)(o.Provider,{value:p,children:t})}},2945:(e,t,a)=>{"use strict";a.d(t,{KC:()=>n.KC,gK:()=>n.gK,k5:()=>n.k5,mu:()=>n.mu,rZ:()=>n.rZ});var n=a(5487)},5887:(e,t,a)=>{"use strict";a.d(t,{j:()=>i,db:()=>o});var n=a(399),l=a(7058),s=a(9904);let r=(0,s.Dk)().length>0?(0,s.Sx)():(0,s.Wp)({apiKey:"AIzaSyCF7z5BRgDlaCzh9FqmEC4CWJ8JBg4DYmI",authDomain:"moneytracking-1dcdc.firebaseapp.com",projectId:"moneytracking-1dcdc",storageBucket:"moneytracking-1dcdc.firebasestorage.app",messagingSenderId:"755165187671",appId:"1:755165187671:web:a90725c76fb3a807885d12",measurementId:"G-LH2ZR4QFK7"}),i=(0,n.xI)(r),o=(0,l.aU)(r)},5487:(e,t,a)=>{"use strict";a.d(t,{KC:()=>m,NR:()=>d,dW:()=>c,gK:()=>v,k5:()=>b,mu:()=>p,rZ:()=>u});var n=a(7058),l=a(5887);function s(){return new Date().toISOString()}function r(e){return(0,n.H9)(l.db,"users",e,"profile","main")}function i(e,t){return(0,n.H9)(l.db,"users",e,"months",t)}function o(e){var t,a,n,l,r,i,o,u,d,c;return{initialPrincipal:Number(null!==(t=e.initialPrincipal)&&void 0!==t?t:0),principal:Number(null!==(a=e.principal)&&void 0!==a?a:0),classRate:Number(null!==(n=e.classRate)&&void 0!==n?n:500),monthlyInterestRate:Number(null!==(l=e.monthlyInterestRate)&&void 0!==l?l:0),totalClasses:Number(null!==(r=e.totalClasses)&&void 0!==r?r:0),totalClassIncome:Number(null!==(i=e.totalClassIncome)&&void 0!==i?i:0),totalInterest:Number(null!==(o=e.totalInterest)&&void 0!==o?o:0),totalExpenses:Number(null!==(u=e.totalExpenses)&&void 0!==u?u:0),createdAt:String(null!==(d=e.createdAt)&&void 0!==d?d:s()),updatedAt:String(null!==(c=e.updatedAt)&&void 0!==c?c:s())}}async function u(e){let t=r(e);if((await (0,n.x7)(t)).exists())return;let a=s();await (0,n.BN)(t,{initialPrincipal:4e4,principal:4e4,classRate:500,monthlyInterestRate:0,totalClasses:0,totalClassIncome:0,totalInterest:0,totalExpenses:0,createdAt:a,updatedAt:a})}function d(e,t,a){return(0,n.aQ)(r(e),e=>{let a=e.data();a&&t(o(a))},a)}function c(e,t){let a=(0,n.P)((0,n.rJ)(l.db,"users",e,"months"),(0,n.My)("monthKey","desc"));return(0,n.aQ)(a,e=>{t(e.docs.map(e=>{var t,a,n,l,r,i,o,u;let d=e.data();return{monthKey:String(null!==(t=d.monthKey)&&void 0!==t?t:e.id),classesTaken:Number(null!==(a=d.classesTaken)&&void 0!==a?a:0),classIncome:Number(null!==(n=d.classIncome)&&void 0!==n?n:0),interestApplied:!!(null!==(l=d.interestApplied)&&void 0!==l&&l),interestAmount:Number(null!==(r=d.interestAmount)&&void 0!==r?r:0),expenseTotal:Number(null!==(i=d.expenseTotal)&&void 0!==i?i:0),closingPrincipal:Number(null!==(o=d.closingPrincipal)&&void 0!==o?o:0),updatedAt:String(null!==(u=d.updatedAt)&&void 0!==u?u:s())}}))})}async function p(e,t){await (0,n.c4)(l.db,async a=>{let n=r(e),l=await a.get(n);if(!l.exists())throw Error("Profile not found");let i=o(l.data());a.set(n,{...i,...t,updatedAt:s()})})}async function m(e,t,a,u){if(a<0)throw Error("Classes cannot be negative");await (0,n.c4)(l.db,async n=>{var l,d,c,p,m;let v=r(e),b=i(e,t),g=await n.get(v),f=await n.get(b);if(!g.exists())throw Error("Profile not found");let A=o(g.data()),I=null!==(l=f.data())&&void 0!==l?l:{},N=a-Number(null!==(d=I.classesTaken)&&void 0!==d?d:0),h=N*u,w=A.principal+h,y={monthKey:t,classesTaken:a,classIncome:a*u,interestApplied:!!(null!==(c=I.interestApplied)&&void 0!==c&&c),interestAmount:Number(null!==(p=I.interestAmount)&&void 0!==p?p:0),expenseTotal:Number(null!==(m=I.expenseTotal)&&void 0!==m?m:0),closingPrincipal:w,updatedAt:s()};n.set(b,y,{merge:!0}),n.set(v,{...A,principal:w,totalClasses:A.totalClasses+N,totalClassIncome:A.totalClassIncome+h,updatedAt:s()},{merge:!0})})}async function v(e,t,a){await (0,n.c4)(l.db,async u=>{var d,c,p,m,v;let b=r(e),g=i(e,t),f=(0,n.H9)(l.db,"users",e,"interestHistory",t),A=await u.get(b),I=await u.get(g),N=await u.get(f);if(!A.exists())throw Error("Profile not found");if(N.exists())throw Error("Interest already applied for ".concat(t));let h=o(A.data()),w=null!==(d=I.data())&&void 0!==d?d:{};if(null!==(c=w.interestApplied)&&void 0!==c&&c)throw Error("Interest already applied for ".concat(t));let y=h.principal*a/100,x=h.principal+y;u.set(g,{monthKey:t,classesTaken:Number(null!==(p=w.classesTaken)&&void 0!==p?p:0),classIncome:Number(null!==(m=w.classIncome)&&void 0!==m?m:0),interestApplied:!0,interestAmount:y,expenseTotal:Number(null!==(v=w.expenseTotal)&&void 0!==v?v:0),closingPrincipal:x,updatedAt:s()},{merge:!0});let C={monthKey:t,interestAmount:y,appliedAt:s(),rateApplied:a};u.set(f,C),u.set(b,{...h,principal:x,totalInterest:h.totalInterest+y,updatedAt:s()},{merge:!0})})}async function b(e,t){if(t.amount<=0)throw Error("Expense amount must be positive");let a=t.dateISO.slice(0,7);await (0,n.c4)(l.db,async u=>{var d,c,p,m,v,b;let g=r(e),f=i(e,a),A=(0,n.H9)((0,n.rJ)(l.db,"users",e,"expenses")),I=await u.get(g),N=await u.get(f);if(!I.exists())throw Error("Profile not found");let h=o(I.data()),w=null!==(d=N.data())&&void 0!==d?d:{},y=h.principal-t.amount,x={amount:t.amount,category:t.category,dateISO:t.dateISO,monthKey:a,createdAt:s()};u.set(A,{...x,createdAtServer:(0,n.O5)()}),u.set(f,{monthKey:a,classesTaken:Number(null!==(c=w.classesTaken)&&void 0!==c?c:0),classIncome:Number(null!==(p=w.classIncome)&&void 0!==p?p:0),interestApplied:!!(null!==(m=w.interestApplied)&&void 0!==m&&m),interestAmount:Number(null!==(v=w.interestAmount)&&void 0!==v?v:0),expenseTotal:Number(null!==(b=w.expenseTotal)&&void 0!==b?b:0)+t.amount,closingPrincipal:y,updatedAt:s()},{merge:!0}),u.set(g,{...h,principal:y,totalExpenses:h.totalExpenses+t.amount,updatedAt:s()},{merge:!0})})}},9324:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[533,992,138,459,441,517,358],()=>t(8708)),_N_E=e.O()}]);