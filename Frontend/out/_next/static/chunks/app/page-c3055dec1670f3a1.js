(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{7841:(e,t,a)=>{Promise.resolve().then(a.bind(a,8152))},8152:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var n=a(5155),s=a(2115),l=a(6046),r=a(8449);function i(){let{user:e,loading:t}=(0,r.A)(),a=(0,l.useRouter)();return(0,s.useEffect)(()=>{t||a.replace(e?"/dashboard":"/signin")},[t,a,e]),(0,n.jsx)("main",{className:"p-6 text-sm text-slate-600",children:"Loading..."})}},5459:(e,t,a)=>{"use strict";a.d(t,{AuthProvider:()=>u,c:()=>o});var n=a(5155),s=a(2115),l=a(399),r=a(5887),i=a(2945);let o=(0,s.createContext)({user:null,loading:!0});function u(e){let{children:t}=e,[a,u]=(0,s.useState)(null),[d,c]=(0,s.useState)(!0);(0,s.useEffect)(()=>(0,l.hg)(r.j,async e=>{u(e),e&&await (0,i.rZ)(e.uid),c(!1)}),[]);let p=(0,s.useMemo)(()=>({user:a,loading:d}),[d,a]);return(0,n.jsx)(o.Provider,{value:p,children:t})}},8449:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(2115),s=a(5459);function l(){return(0,n.useContext)(s.c)}},2945:(e,t,a)=>{"use strict";a.d(t,{KC:()=>n.KC,gK:()=>n.gK,k5:()=>n.k5,mu:()=>n.mu,rZ:()=>n.rZ});var n=a(5487)},5887:(e,t,a)=>{"use strict";a.d(t,{j:()=>i,db:()=>o});var n=a(399),s=a(7058),l=a(9904);let r=(0,l.Dk)().length>0?(0,l.Sx)():(0,l.Wp)({apiKey:"AIzaSyCF7z5BRgDlaCzh9FqmEC4CWJ8JBg4DYmI",authDomain:"moneytracking-1dcdc.firebaseapp.com",projectId:"moneytracking-1dcdc",storageBucket:"moneytracking-1dcdc.firebasestorage.app",messagingSenderId:"755165187671",appId:"1:755165187671:web:a90725c76fb3a807885d12",measurementId:"G-LH2ZR4QFK7"}),i=(0,n.xI)(r),o=(0,s.aU)(r)},5487:(e,t,a)=>{"use strict";a.d(t,{KC:()=>m,NR:()=>d,dW:()=>c,gK:()=>v,k5:()=>f,mu:()=>p,rZ:()=>u});var n=a(7058),s=a(5887);function l(){return new Date().toISOString()}function r(e){return(0,n.H9)(s.db,"users",e,"profile","main")}function i(e,t){return(0,n.H9)(s.db,"users",e,"months",t)}function o(e){var t,a,n,s,r,i,o,u,d,c;return{initialPrincipal:Number(null!==(t=e.initialPrincipal)&&void 0!==t?t:0),principal:Number(null!==(a=e.principal)&&void 0!==a?a:0),classRate:Number(null!==(n=e.classRate)&&void 0!==n?n:500),monthlyInterestRate:Number(null!==(s=e.monthlyInterestRate)&&void 0!==s?s:0),totalClasses:Number(null!==(r=e.totalClasses)&&void 0!==r?r:0),totalClassIncome:Number(null!==(i=e.totalClassIncome)&&void 0!==i?i:0),totalInterest:Number(null!==(o=e.totalInterest)&&void 0!==o?o:0),totalExpenses:Number(null!==(u=e.totalExpenses)&&void 0!==u?u:0),createdAt:String(null!==(d=e.createdAt)&&void 0!==d?d:l()),updatedAt:String(null!==(c=e.updatedAt)&&void 0!==c?c:l())}}async function u(e){let t=r(e);if((await (0,n.x7)(t)).exists())return;let a=l();await (0,n.BN)(t,{initialPrincipal:4e4,principal:4e4,classRate:500,monthlyInterestRate:0,totalClasses:0,totalClassIncome:0,totalInterest:0,totalExpenses:0,createdAt:a,updatedAt:a})}function d(e,t,a){return(0,n.aQ)(r(e),e=>{let a=e.data();a&&t(o(a))},a)}function c(e,t){let a=(0,n.P)((0,n.rJ)(s.db,"users",e,"months"),(0,n.My)("monthKey","desc"));return(0,n.aQ)(a,e=>{t(e.docs.map(e=>{var t,a,n,s,r,i,o,u;let d=e.data();return{monthKey:String(null!==(t=d.monthKey)&&void 0!==t?t:e.id),classesTaken:Number(null!==(a=d.classesTaken)&&void 0!==a?a:0),classIncome:Number(null!==(n=d.classIncome)&&void 0!==n?n:0),interestApplied:!!(null!==(s=d.interestApplied)&&void 0!==s&&s),interestAmount:Number(null!==(r=d.interestAmount)&&void 0!==r?r:0),expenseTotal:Number(null!==(i=d.expenseTotal)&&void 0!==i?i:0),closingPrincipal:Number(null!==(o=d.closingPrincipal)&&void 0!==o?o:0),updatedAt:String(null!==(u=d.updatedAt)&&void 0!==u?u:l())}}))})}async function p(e,t){await (0,n.c4)(s.db,async a=>{let n=r(e),s=await a.get(n);if(!s.exists())throw Error("Profile not found");let i=o(s.data());a.set(n,{...i,...t,updatedAt:l()})})}async function m(e,t,a,u){if(a<0)throw Error("Classes cannot be negative");await (0,n.c4)(s.db,async n=>{var s,d,c,p,m;let v=r(e),f=i(e,t),g=await n.get(v),b=await n.get(f);if(!g.exists())throw Error("Profile not found");let A=o(g.data()),I=null!==(s=b.data())&&void 0!==s?s:{},x=a-Number(null!==(d=I.classesTaken)&&void 0!==d?d:0),N=x*u,h=A.principal+N,w={monthKey:t,classesTaken:a,classIncome:a*u,interestApplied:!!(null!==(c=I.interestApplied)&&void 0!==c&&c),interestAmount:Number(null!==(p=I.interestAmount)&&void 0!==p?p:0),expenseTotal:Number(null!==(m=I.expenseTotal)&&void 0!==m?m:0),closingPrincipal:h,updatedAt:l()};n.set(f,w,{merge:!0}),n.set(v,{...A,principal:h,totalClasses:A.totalClasses+x,totalClassIncome:A.totalClassIncome+N,updatedAt:l()},{merge:!0})})}async function v(e,t,a){await (0,n.c4)(s.db,async u=>{var d,c,p,m,v;let f=r(e),g=i(e,t),b=(0,n.H9)(s.db,"users",e,"interestHistory",t),A=await u.get(f),I=await u.get(g),x=await u.get(b);if(!A.exists())throw Error("Profile not found");if(x.exists())throw Error("Interest already applied for ".concat(t));let N=o(A.data()),h=null!==(d=I.data())&&void 0!==d?d:{};if(null!==(c=h.interestApplied)&&void 0!==c&&c)throw Error("Interest already applied for ".concat(t));let w=N.principal*a/100,y=N.principal+w;u.set(g,{monthKey:t,classesTaken:Number(null!==(p=h.classesTaken)&&void 0!==p?p:0),classIncome:Number(null!==(m=h.classIncome)&&void 0!==m?m:0),interestApplied:!0,interestAmount:w,expenseTotal:Number(null!==(v=h.expenseTotal)&&void 0!==v?v:0),closingPrincipal:y,updatedAt:l()},{merge:!0});let C={monthKey:t,interestAmount:w,appliedAt:l(),rateApplied:a};u.set(b,C),u.set(f,{...N,principal:y,totalInterest:N.totalInterest+w,updatedAt:l()},{merge:!0})})}async function f(e,t){if(t.amount<=0)throw Error("Expense amount must be positive");let a=t.dateISO.slice(0,7);await (0,n.c4)(s.db,async u=>{var d,c,p,m,v,f;let g=r(e),b=i(e,a),A=(0,n.H9)((0,n.rJ)(s.db,"users",e,"expenses")),I=await u.get(g),x=await u.get(b);if(!I.exists())throw Error("Profile not found");let N=o(I.data()),h=null!==(d=x.data())&&void 0!==d?d:{},w=N.principal-t.amount,y={amount:t.amount,category:t.category,dateISO:t.dateISO,monthKey:a,createdAt:l()};u.set(A,{...y,createdAtServer:(0,n.O5)()}),u.set(b,{monthKey:a,classesTaken:Number(null!==(c=h.classesTaken)&&void 0!==c?c:0),classIncome:Number(null!==(p=h.classIncome)&&void 0!==p?p:0),interestApplied:!!(null!==(m=h.interestApplied)&&void 0!==m&&m),interestAmount:Number(null!==(v=h.interestAmount)&&void 0!==v?v:0),expenseTotal:Number(null!==(f=h.expenseTotal)&&void 0!==f?f:0)+t.amount,closingPrincipal:w,updatedAt:l()},{merge:!0}),u.set(g,{...N,principal:w,totalExpenses:N.totalExpenses+t.amount,updatedAt:l()},{merge:!0})})}},6046:(e,t,a)=>{"use strict";var n=a(6658);a.o(n,"useRouter")&&a.d(t,{useRouter:function(){return n.useRouter}})}},e=>{var t=t=>e(e.s=t);e.O(0,[992,138,459,441,517,358],()=>t(7841)),_N_E=e.O()}]);