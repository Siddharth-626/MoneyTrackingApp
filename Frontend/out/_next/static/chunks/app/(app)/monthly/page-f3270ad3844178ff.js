(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[913],{1954:(e,t,s)=>{Promise.resolve().then(s.bind(s,5331))},5331:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(5155),n=s(8173),l=s.n(n),r=s(3474),i=s(1316);function o(e){let{rows:t}=e;return 0===t.length?(0,a.jsx)("p",{className:"rounded-xl bg-white p-4 text-sm text-slate-600 shadow-panel",children:"No monthly records yet."}):(0,a.jsx)("div",{className:"overflow-x-auto rounded-2xl bg-white shadow-panel",children:(0,a.jsxs)("table",{className:"min-w-full text-left text-sm",children:[(0,a.jsx)("thead",{className:"border-b bg-slate-50 text-slate-600",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3",children:"Month"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Classes"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Class Income"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Interest"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Expenses"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Closing Principal"})]})}),(0,a.jsx)("tbody",{children:t.map(e=>(0,a.jsxs)("tr",{className:"border-b last:border-b-0",children:[(0,a.jsx)("td",{className:"px-4 py-3",children:e.monthKey}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.classesTaken}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,i.v)(e.classIncome)}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,i.v)(e.interestAmount)}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,i.v)(e.expenseTotal)}),(0,a.jsx)("td",{className:"px-4 py-3 font-medium",children:(0,i.v)(e.closingPrincipal)})]},e.monthKey))})]})})}var c=s(2115),d=s(8449),u=s(5487),p=s(9743);function m(){let{rows:e,loading:t}=function(){let{user:e}=(0,d.A)(),[t,s]=(0,c.useState)([]),[a,n]=(0,c.useState)(!0);return(0,c.useEffect)(()=>{if(!e){s([]),n(!1);return}return n(!0),(0,u.dW)(e.uid,e=>{s(e),n(!1)})},[e]),{rows:t,loading:a}}();return(0,a.jsx)(r.i,{children:(0,a.jsxs)("main",{className:"mx-auto max-w-6xl p-4 md:p-8",children:[(0,a.jsxs)("header",{className:"mb-6 flex flex-wrap items-center justify-between gap-2",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-slateInk md:text-3xl",children:"Monthly Breakdown"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(l(),{href:"/dashboard",className:"rounded-xl bg-bankBlue px-4 py-2 text-sm font-medium text-white",children:"Back"}),(0,a.jsx)("button",{type:"button",onClick:p.B,className:"rounded-xl border border-slate-300 bg-white px-4 py-2 text-sm",children:"Sign Out"})]})]}),t?(0,a.jsx)("p",{className:"text-slate-600",children:"Loading months..."}):(0,a.jsx)(o,{rows:e})]})})}},3474:(e,t,s)=>{"use strict";s.d(t,{i:()=>i});var a=s(5155),n=s(2115),l=s(6046),r=s(8449);function i(e){let{children:t}=e,{user:s,loading:i}=(0,r.A)(),o=(0,l.useRouter)();return((0,n.useEffect)(()=>{i||s||o.replace("/signin")},[i,o,s]),i||!s)?(0,a.jsx)("div",{className:"p-6 text-sm text-slate-600",children:"Authenticating..."}):(0,a.jsx)(a.Fragment,{children:t})}},5459:(e,t,s)=>{"use strict";s.d(t,{AuthProvider:()=>c,c:()=>o});var a=s(5155),n=s(2115),l=s(399),r=s(5887),i=s(2945);let o=(0,n.createContext)({user:null,loading:!0});function c(e){let{children:t}=e,[s,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(!0);(0,n.useEffect)(()=>(0,l.hg)(r.j,async e=>{c(e),e&&await (0,i.rZ)(e.uid),u(!1)}),[]);let p=(0,n.useMemo)(()=>({user:s,loading:d}),[d,s]);return(0,a.jsx)(o.Provider,{value:p,children:t})}},8449:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var a=s(2115),n=s(5459);function l(){return(0,a.useContext)(n.c)}},1316:(e,t,s)=>{"use strict";function a(e){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:2}).format(e)}function n(e){return{currentPrincipal:e.principal,totalClasses:e.totalClasses,totalClassIncome:e.totalClassIncome,totalInterest:e.totalInterest,totalExpenses:e.totalExpenses,netGrowth:e.principal-e.initialPrincipal}}s.d(t,{q:()=>n,v:()=>a})},2945:(e,t,s)=>{"use strict";s.d(t,{KC:()=>a.KC,gK:()=>a.gK,k5:()=>a.k5,mu:()=>a.mu,rZ:()=>a.rZ});var a=s(5487)},9743:(e,t,s)=>{"use strict";s.d(t,{B:()=>r,G:()=>l});var a=s(399),n=s(5887);async function l(){let e=new a.HF;await (0,a.df)(n.j,e)}async function r(){await (0,a.CI)(n.j)}},5887:(e,t,s)=>{"use strict";s.d(t,{j:()=>i,db:()=>o});var a=s(399),n=s(7058),l=s(9904);let r=(0,l.Dk)().length>0?(0,l.Sx)():(0,l.Wp)({apiKey:"AIzaSyCF7z5BRgDlaCzh9FqmEC4CWJ8JBg4DYmI",authDomain:"moneytracking-1dcdc.firebaseapp.com",projectId:"moneytracking-1dcdc",storageBucket:"moneytracking-1dcdc.firebasestorage.app",messagingSenderId:"755165187671",appId:"1:755165187671:web:a90725c76fb3a807885d12",measurementId:"G-LH2ZR4QFK7"}),i=(0,a.xI)(r),o=(0,n.aU)(r)},5487:(e,t,s)=>{"use strict";s.d(t,{KC:()=>m,NR:()=>d,dW:()=>u,gK:()=>x,k5:()=>h,mu:()=>p,rZ:()=>c});var a=s(7058),n=s(5887);function l(){return new Date().toISOString()}function r(e){return(0,a.H9)(n.db,"users",e,"profile","main")}function i(e,t){return(0,a.H9)(n.db,"users",e,"months",t)}function o(e){var t,s,a,n,r,i,o,c,d,u;return{initialPrincipal:Number(null!==(t=e.initialPrincipal)&&void 0!==t?t:0),principal:Number(null!==(s=e.principal)&&void 0!==s?s:0),classRate:Number(null!==(a=e.classRate)&&void 0!==a?a:500),monthlyInterestRate:Number(null!==(n=e.monthlyInterestRate)&&void 0!==n?n:0),totalClasses:Number(null!==(r=e.totalClasses)&&void 0!==r?r:0),totalClassIncome:Number(null!==(i=e.totalClassIncome)&&void 0!==i?i:0),totalInterest:Number(null!==(o=e.totalInterest)&&void 0!==o?o:0),totalExpenses:Number(null!==(c=e.totalExpenses)&&void 0!==c?c:0),createdAt:String(null!==(d=e.createdAt)&&void 0!==d?d:l()),updatedAt:String(null!==(u=e.updatedAt)&&void 0!==u?u:l())}}async function c(e){let t=r(e);if((await (0,a.x7)(t)).exists())return;let s=l();await (0,a.BN)(t,{initialPrincipal:4e4,principal:4e4,classRate:500,monthlyInterestRate:0,totalClasses:0,totalClassIncome:0,totalInterest:0,totalExpenses:0,createdAt:s,updatedAt:s})}function d(e,t,s){return(0,a.aQ)(r(e),e=>{let s=e.data();s&&t(o(s))},s)}function u(e,t){let s=(0,a.P)((0,a.rJ)(n.db,"users",e,"months"),(0,a.My)("monthKey","desc"));return(0,a.aQ)(s,e=>{t(e.docs.map(e=>{var t,s,a,n,r,i,o,c;let d=e.data();return{monthKey:String(null!==(t=d.monthKey)&&void 0!==t?t:e.id),classesTaken:Number(null!==(s=d.classesTaken)&&void 0!==s?s:0),classIncome:Number(null!==(a=d.classIncome)&&void 0!==a?a:0),interestApplied:!!(null!==(n=d.interestApplied)&&void 0!==n&&n),interestAmount:Number(null!==(r=d.interestAmount)&&void 0!==r?r:0),expenseTotal:Number(null!==(i=d.expenseTotal)&&void 0!==i?i:0),closingPrincipal:Number(null!==(o=d.closingPrincipal)&&void 0!==o?o:0),updatedAt:String(null!==(c=d.updatedAt)&&void 0!==c?c:l())}}))})}async function p(e,t){await (0,a.c4)(n.db,async s=>{let a=r(e),n=await s.get(a);if(!n.exists())throw Error("Profile not found");let i=o(n.data());s.set(a,{...i,...t,updatedAt:l()})})}async function m(e,t,s,c){if(s<0)throw Error("Classes cannot be negative");await (0,a.c4)(n.db,async a=>{var n,d,u,p,m;let x=r(e),h=i(e,t),f=await a.get(x),v=await a.get(h);if(!f.exists())throw Error("Profile not found");let b=o(f.data()),g=null!==(n=v.data())&&void 0!==n?n:{},N=s-Number(null!==(d=g.classesTaken)&&void 0!==d?d:0),y=N*c,w=b.principal+y,I={monthKey:t,classesTaken:s,classIncome:s*c,interestApplied:!!(null!==(u=g.interestApplied)&&void 0!==u&&u),interestAmount:Number(null!==(p=g.interestAmount)&&void 0!==p?p:0),expenseTotal:Number(null!==(m=g.expenseTotal)&&void 0!==m?m:0),closingPrincipal:w,updatedAt:l()};a.set(h,I,{merge:!0}),a.set(x,{...b,principal:w,totalClasses:b.totalClasses+N,totalClassIncome:b.totalClassIncome+y,updatedAt:l()},{merge:!0})})}async function x(e,t,s){await (0,a.c4)(n.db,async c=>{var d,u,p,m,x;let h=r(e),f=i(e,t),v=(0,a.H9)(n.db,"users",e,"interestHistory",t),b=await c.get(h),g=await c.get(f),N=await c.get(v);if(!b.exists())throw Error("Profile not found");if(N.exists())throw Error("Interest already applied for ".concat(t));let y=o(b.data()),w=null!==(d=g.data())&&void 0!==d?d:{};if(null!==(u=w.interestApplied)&&void 0!==u&&u)throw Error("Interest already applied for ".concat(t));let I=y.principal*s/100,A=y.principal+I;c.set(f,{monthKey:t,classesTaken:Number(null!==(p=w.classesTaken)&&void 0!==p?p:0),classIncome:Number(null!==(m=w.classIncome)&&void 0!==m?m:0),interestApplied:!0,interestAmount:I,expenseTotal:Number(null!==(x=w.expenseTotal)&&void 0!==x?x:0),closingPrincipal:A,updatedAt:l()},{merge:!0});let j={monthKey:t,interestAmount:I,appliedAt:l(),rateApplied:s};c.set(v,j),c.set(h,{...y,principal:A,totalInterest:y.totalInterest+I,updatedAt:l()},{merge:!0})})}async function h(e,t){if(t.amount<=0)throw Error("Expense amount must be positive");let s=t.dateISO.slice(0,7);await (0,a.c4)(n.db,async c=>{var d,u,p,m,x,h;let f=r(e),v=i(e,s),b=(0,a.H9)((0,a.rJ)(n.db,"users",e,"expenses")),g=await c.get(f),N=await c.get(v);if(!g.exists())throw Error("Profile not found");let y=o(g.data()),w=null!==(d=N.data())&&void 0!==d?d:{},I=y.principal-t.amount,A={amount:t.amount,category:t.category,dateISO:t.dateISO,monthKey:s,createdAt:l()};c.set(b,{...A,createdAtServer:(0,a.O5)()}),c.set(v,{monthKey:s,classesTaken:Number(null!==(u=w.classesTaken)&&void 0!==u?u:0),classIncome:Number(null!==(p=w.classIncome)&&void 0!==p?p:0),interestApplied:!!(null!==(m=w.interestApplied)&&void 0!==m&&m),interestAmount:Number(null!==(x=w.interestAmount)&&void 0!==x?x:0),expenseTotal:Number(null!==(h=w.expenseTotal)&&void 0!==h?h:0)+t.amount,closingPrincipal:I,updatedAt:l()},{merge:!0}),c.set(f,{...y,principal:I,totalExpenses:y.totalExpenses+t.amount,updatedAt:l()},{merge:!0})})}},6046:(e,t,s)=>{"use strict";var a=s(6658);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})}},e=>{var t=t=>e(e.s=t);e.O(0,[992,138,459,173,441,517,358],()=>t(1954)),_N_E=e.O()}]);